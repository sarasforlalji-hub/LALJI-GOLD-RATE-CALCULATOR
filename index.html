<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lalji Jewellers Gold Rate Calculator</title>

  <!-- PWA Icons -->
  <link rel="icon" type="image/png" href="LOGO.png">
  <link rel="apple-touch-icon" href="LOGO.png">
  <link rel="manifest" href="/manifest.json">

  <!-- Tailwind -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"></noscript>

  <style>
    body { font-family: 'Inter', sans-serif; background-color: #FBF8F1; }
    /* The container-wrapper is fixed to the parent's width with overflow hidden, so only one page is visible */
    .container-wrapper { overflow: hidden; width: 100%; }
    /* The content-wrapper holds all three pages and will be translated left/right */
    .content-wrapper { display: flex; transition: transform 0.4s ease; width: 300%; will-change: transform; align-items: stretch; }
    /* Each calculator page takes up exactly 1/3 of the total content-wrapper width */
    .calculator-page { width: calc(100% / 3); flex-shrink: 0; padding: 1rem; display: flex; justify-content: center; align-items: center; }
    .swipe-indicator { animation: bounce-right 2s infinite; }
    .swipe-indicator.rotate-180 { animation: bounce-left 2s infinite; }
    @keyframes bounce-right { 0%,100%{transform:translateX(0);}50%{transform:translateX(8px);} }
    @keyframes bounce-left { 0%,100%{transform:translateX(0);}50%{transform:translateX(-8px);} }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6">

  <div class="container-wrapper max-w-2xl w-full">
    <div id="contentWrapper" class="content-wrapper">
      
      <!-- First Calculator Page (Gold Rate) -->
      <div class="calculator-page">
        <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-10 border border-gray-100 max-w-md w-full h-full flex flex-col justify-between relative">
          <!-- New Toggle Rates button -->
          <div class="absolute top-4 right-4 sm:top-6 sm:right-6">
            <button id="toggleRatesBtn" class="text-gray-600 hover:text-[#A98E66] transition text-sm">
              <i class="fas fa-sync-alt text-lg"></i>
            </button>
          </div>
          
          <div class="flex flex-col items-center mb-6">
            <!-- Logo -->
            <img src="LOGO.png" alt="Lalji Jewellers Logo" class="w-24 h-24 mb-4">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-[#A98E66] text-center mb-2">
              Gold Rate Calculator
            </h1>
            <button class="text-gray-500 text-sm mt-2 flex items-center swipe-indicator" onclick="swipe(1)">
              Swipe Left for Jewellery Calculator <i class="fas fa-arrow-right ml-2"></i>
            </button>
          </div>
          <p class="text-center text-gray-600 mb-8 text-lg">Enter The 9999 Gold Rate To Calculate Prices For All Other Purities</p>
          <div class="mb-6">
            <label for="rate9999" class="block text-sm font-semibold text-gray-700 mb-2">9999 Gold Rate</label>
            <input type="number" id="rate9999" placeholder="Enter Rate For 10-Grams..." class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#A98E66] focus:border-transparent shadow-sm">
          </div>
          <div id="goldRatesDisplay" class="space-y-4">
            <!-- Rates will be dynamically populated here -->
          </div>
          <p class="text-xs text-gray-400 text-center mt-8">© Copyright Of Lalji Gems & Jewellers Pvt. Ltd.</p>
        </div>
      </div>

      <!-- Second Calculator Page (Jewellery) -->
      <div class="calculator-page" id="jewelleryCalculator">
        <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-10 border border-gray-100 max-w-md w-full h-full relative">
          
          <!-- Settings button -->
          <div class="absolute top-4 right-4 sm:top-6 sm:right-6">
            <button id="settingsBtn" class="text-gray-600 hover:text-[#A98E66] transition"><i class="fas fa-cog text-xl"></i></button>
          </div>

          <div class="flex flex-col items-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-[#A98E66] text-center mb-2">Jewellery Price Calculator</h1>
            
            <!-- New buttons for navigation -->
            <div class="flex justify-between w-full mt-2">
              <button class="text-gray-500 text-sm flex items-center swipe-indicator rotate-180" onclick="swipe(0)">
                <i class="fas fa-arrow-left mr-2"></i>Swipe Right to go Back
              </button>
              <button class="text-gray-500 text-sm flex items-center swipe-indicator" onclick="swipe(2)">
                Swipe Left for Diamond Calculator <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </div>

          <p class="text-center text-gray-600 mb-8 text-lg">Calculate Sale Price</p>
          
          <!-- Inputs -->
          <div class="mb-6">
            <label for="jewelleryWeight" class="block text-sm font-semibold text-gray-700 mb-2">Jewellery Weight (Grams)</label>
            <input type="number" id="jewelleryWeight" placeholder="Enter Weight..." class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#A98E66] shadow-sm">
          </div>
          
          <!-- New Other Costs Field -->
          <div class="mb-6">
            <label for="otherCosts" class="block text-sm font-semibold text-gray-700 mb-2">Other Costs (₹)</label>
            <input type="number" id="otherCosts" value="0" placeholder="Enter Other Costs..." class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#A98E66] shadow-sm">
          </div>

          <div class="mb-8">
            <span class="block text-sm font-semibold text-gray-700 mb-2">Purity</span>
            <div class="flex justify-around space-x-2">
              <label class="flex-1 flex items-center justify-center p-3 border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100">
                <input type="radio" name="jewelleryPurity" value="14kt" class="hidden"><span>14KT</span>
              </label>
              <label class="flex-1 flex items-center justify-center p-3 border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100">
                <input type="radio" name="jewelleryPurity" value="18kt" checked class="hidden"><span>18KT</span>
              </label>
              <label class="flex-1 flex items-center justify-center p-3 border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100">
                <input type="radio" name="jewelleryPurity" value="22kt" class="hidden"><span>22KT</span>
              </label>
            </div>
          </div>

          <!-- Results -->
          <div class="space-y-4">
            <!-- Edited for mobile responsiveness -->
            <div class="bg-gray-50 rounded-2xl p-4 flex flex-col sm:flex-row justify-start sm:justify-between items-start sm:items-center">
              <span>Sale Price</span>
              <span id="salePrice" class="text-2xl font-bold text-[#A98E66] mt-1 sm:mt-0">0.00</span>
            </div>
            <div class="bg-gray-50 rounded-2xl p-4 flex flex-col sm:flex-row justify-start sm:justify-between items-start sm:items-center">
              <span>Discounted Price</span>
              <span id="discountedPrice" class="text-2xl font-bold text-[#A98E66] mt-1 sm:mt-0">0.00</span>
            </div>
          </div>

          <p class="text-sm text-gray-500 text-center mt-6">Note: All prices include 3% GST.</p>
          <p class="text-xs text-gray-400 text-center mt-6">© Copyright Of Lalji Gems & Jewellers Pvt. Ltd.</p>
        </div>
      </div>
      
      <!-- Third Calculator Page (Diamond) -->
      <div class="calculator-page" id="diamondCalculatorPage">
        <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-10 border border-gray-100 max-w-md w-full h-full flex flex-col justify-between relative">
          <div class="flex flex-col items-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-[#A98E66] text-center mb-2">
              Diamond Price Calculator
            </h1>
            <button class="text-gray-500 text-sm mt-2 flex items-center swipe-indicator rotate-180" onclick="swipe(1)">
              <i class="fas fa-arrow-left mr-2"></i>Swipe Right to go Back
            </button>
          </div>
          <p class="text-center text-gray-600 mb-8 text-lg">Enter Diamond Details To Calculate Total Cost</p>
          <div class="space-y-6">
            <!-- Diamond 1 -->
            <div class="bg-gray-50 rounded-2xl p-4">
              <span class="block text-sm font-semibold text-gray-700 mb-2">Diamond 1</span>
              <div class="flex space-x-4">
                <div class="w-1/2">
                  <label for="diamondCaratRate1" class="block text-xs text-gray-500">Rate/Carat</label>
                  <input type="number" id="diamondCaratRate1" placeholder="₹" class="w-full px-2 py-1 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#A98E66] shadow-sm">
                </div>
                <div class="w-1/2">
                  <label for="diamondCaratWeight1" class="block text-xs text-gray-500">Weight (Carats)</label>
                  <input type="number" id="diamondCaratWeight1" placeholder="Carats" class="w-full px-2 py-1 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#A98E66] shadow-sm">
                </div>
              </div>
            </div>
            <!-- Diamond 2 -->
            <div class="bg-gray-50 rounded-2xl p-4">
              <span class="block text-sm font-semibold text-gray-700 mb-2">Diamond 2</span>
              <div class="flex space-x-4">
                <div class="w-1/2">
                  <label for="diamondCaratRate2" class="block text-xs text-gray-500">Rate/Carat</label>
                  <input type="number" id="diamondCaratRate2" placeholder="₹" class="w-full px-2 py-1 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#A98E66] shadow-sm">
                </div>
                <div class="w-1/2">
                  <label for="diamondCaratWeight2" class="block text-xs text-gray-500">Weight (Carats)</label>
                  <input type="number" id="diamondCaratWeight2" placeholder="Carats" class="w-full px-2 py-1 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#A98E66] shadow-sm">
                </div>
              </div>
            </div>
            <!-- Diamond 3 -->
            <div class="bg-gray-50 rounded-2xl p-4">
              <span class="block text-sm font-semibold text-gray-700 mb-2">Diamond 3</span>
              <div class="flex space-x-4">
                <div class="w-1/2">
                  <label for="diamondCaratRate3" class="block text-xs text-gray-500">Rate/Carat</label>
                  <input type="number" id="diamondCaratRate3" placeholder="₹" class="w-full px-2 py-1 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#A98E66] shadow-sm">
                </div>
                <div class="w-1/2">
                  <label for="diamondCaratWeight3" class="block text-xs text-gray-500">Weight (Carats)</label>
                  <input type="number" id="diamondCaratWeight3" placeholder="Carats" class="w-full px-2 py-1 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#A98E66] shadow-sm">
                </div>
              </div>
            </div>
            <!-- Total -->
            <div class="bg-gray-100 rounded-2xl p-4 flex flex-col sm:flex-row justify-start sm:justify-between items-start sm:items-center mt-6">
              <span>Total Diamond Price</span>
              <span id="totalDiamondPrice" class="text-2xl font-bold text-[#A98E66] mt-1 sm:mt-0">0.00</span>
            </div>
          </div>
          <p class="text-xs text-gray-400 text-center mt-8">© Copyright Of Lalji Gems & Jewellers Pvt. Ltd.</p>
        </div>
      </div>

    </div>
  </div>

  <!-- Settings Modal - Moved to the end of the body to fix display issue -->
  <div id="settingsModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl p-6 w-11/12 max-w-sm relative">
      <button id="closeSettingsBtn" class="absolute top-3 right-3 text-gray-700 hover:text-gray-900">
        <i class="fas fa-times text-2xl"></i>
      </button>
      <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Change MC</h2>
      <input type="number" id="discountPercentage" class="w-full text-center px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#A98E66] mb-4" value="17">
      <p class="text-sm text-gray-500 text-center">Example: 17 = 17% MC</p>
    </div>
  </div>

  <script>
    let rate14ktSale=0, rate18ktSale=0, rate22ktSale=0, jewelleryDiscountPercentage=0.17;
    let isSaleRateView = true; // New state variable
    let currentPage = 0; // 0: Gold, 1: Jewellery, 2: Diamond
    let goldRates = {
        sale: { '14kt': 0, '18kt': 0, '22kt': 0 },
        purchase: { '14kt': 0, '18kt': 0, '22kt': 0 }
    };

    /**
     * Creates a debounced function that delays its execution until a specified time has passed.
     * @param {function} func The function to debounce.
     * @param {number} delay The delay in milliseconds.
     */
    function debounce(func,delay){let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>func.apply(this,a),delay)};}

    // Swipe handling
    const contentWrapper=document.getElementById('contentWrapper');
    let touchStartX=0, touchEndX=0, swipeActive=false;
    const swipeThreshold=50;

    // Listens for the start of a touch event to begin tracking.
    document.addEventListener('touchstart',e=>{
      // Disable swipe if the user is interacting with a button, input, or label.
      if(e.target.closest('button')||e.target.closest('input')||e.target.closest('label')){ 
        swipeActive=false; 
        return; 
      }
      swipeActive=true;
      touchStartX=e.touches[0].clientX;
    });

    // Listens for a touch move event to update the end position.
    document.addEventListener('touchmove',e=>{
      if(!swipeActive) return;
      touchEndX=e.touches[0].clientX;
    });
    
    // Listens for the end of a touch event to determine if a swipe occurred.
    document.addEventListener('touchend',()=>{
      if(!swipeActive) return;
      const diff=touchEndX-touchStartX;
      // If the swipe distance exceeds the threshold, trigger the swipe.
      if(Math.abs(diff)>swipeThreshold){
        if(diff<0 && currentPage < 2){ swipe(currentPage + 1); }
        else if(diff>0 && currentPage > 0){ swipe(currentPage - 1); }
      }
      swipeActive=false;
    });

    /**
     * Swipes to a specific calculator page.
     * @param {number} pageIndex The index of the page to swipe to (0, 1, or 2).
     */
    function swipe(pageIndex) {
      currentPage = pageIndex;
      // This is the key fix: translate the content wrapper by a percentage of its width.
      // Since each page is 1/3 of the container, a swipe moves the container by 100% / 3 = 33.33% of its own width.
      contentWrapper.style.transform = `translateX(-${pageIndex * 100 / 3}%)`;
    }

    // Rates calculation
    function calculateRates(){
      const r=parseFloat(document.getElementById('rate9999').value);
      if(isNaN(r)||r<=0){
        goldRates.sale = { '14kt': 0, '18kt': 0, '22kt': 0 };
        goldRates.purchase = { '14kt': 0, '18kt': 0, '22kt': 0 };
      } else {
        const ratePerGram9708 = (r / 10) * 0.9708738;
        goldRates.sale['14kt'] = ratePerGram9708 * 0.583;
        goldRates.sale['18kt'] = ratePerGram9708 * 0.75; 
        goldRates.sale['22kt'] = ratePerGram9708 * 0.916;
        
        goldRates.purchase['14kt'] = goldRates.sale['14kt'] - 200;
        goldRates.purchase['18kt'] = goldRates.sale['18kt'] - 200;
        goldRates.purchase['22kt'] = goldRates.sale['22kt'] - 200;
      }

      updateGoldRatesDisplay();
      calculateJewelleryPrice();
    }
    
    /**
     * Updates the gold rate display based on the current view (Sale or Purchase).
     */
    function updateGoldRatesDisplay() {
        const ratesContainer = document.getElementById('goldRatesDisplay');
        ratesContainer.innerHTML = ''; // Clear existing content
        const ratesToDisplay = isSaleRateView ? goldRates.sale : goldRates.purchase;

        const rateNames = ['14KT', '18KT', '22KT'];
        rateNames.forEach(name => {
            const kt = name.toLowerCase();
            const value = ratesToDisplay[kt];
            const displayTitle = `${name} ${isSaleRateView ? 'Sale' : 'Purchase'} Rate`;
            const html = `
                <div class="bg-gray-50 rounded-2xl p-4 flex flex-col sm:flex-row justify-start sm:justify-between items-start sm:items-center">
                    <span>${displayTitle}</span>
                    <span id="rate${kt}${isSaleRateView ? 'Sale' : 'Purchase'}" class="text-2xl font-bold text-[#A98E66] mt-1 sm:mt-0">${value.toFixed(2)}</span>
                </div>`;
            ratesContainer.innerHTML += html;
        });
    }

    /**
     * Toggles the view between Sale Rates and Purchase Rates.
     */
    function toggleRateView() {
        isSaleRateView = !isSaleRateView;
        updateGoldRatesDisplay();
    }
    
    /**
     * Calculates the total price of all diamonds based on their carat rate and weight.
     */
    function calculateDiamondTotal() {
      const rate1 = parseFloat(document.getElementById('diamondCaratRate1').value) || 0;
      const weight1 = parseFloat(document.getElementById('diamondCaratWeight1').value) || 0;
      const rate2 = parseFloat(document.getElementById('diamondCaratRate2').value) || 0;
      const weight2 = parseFloat(document.getElementById('diamondCaratWeight2').value) || 0;
      const rate3 = parseFloat(document.getElementById('diamondCaratRate3').value) || 0;
      const weight3 = parseFloat(document.getElementById('diamondCaratWeight3').value) || 0;
      
      const total = (rate1 * weight1) + (rate2 * weight2) + (rate3 * weight3);
      document.getElementById('totalDiamondPrice').textContent = total.toFixed(2);
      
      document.getElementById('otherCosts').value = total.toFixed(2);
      calculateJewelleryPrice();
    }

    /**
     * Calculates the jewellery price based on weight, purity, and other costs.
     */
    function calculateJewelleryPrice(){
      const w=parseFloat(document.getElementById('jewelleryWeight').value) || 0;
      const oc=parseFloat(document.getElementById('otherCosts').value) || 0;
      const p=document.querySelector('input[name="jewelleryPurity"]:checked').value;
      
      let base=0;
      if(p==='14kt'){
        base = goldRates.sale['14kt'];
      } else if(p==='18kt'){
        base = goldRates.sale['18kt'];
      } else if(p==='22kt'){
        base = goldRates.sale['22kt'];
      }

      if(base===0){
        salePrice.textContent=discountedPrice.textContent='N/A';
        return;
      }
      
      const goldCost = base * w;
      salePrice.textContent=(((goldCost + oc) * (1 + jewelleryDiscountPercentage + 0.03)) * 1.03).toFixed(2);
      discountedPrice.textContent=(((goldCost + oc) * (1 + jewelleryDiscountPercentage)) * 1.03).toFixed(2);
    }

    // Modal logic
    const settingsBtn=document.getElementById('settingsBtn');
    const settingsModal=document.getElementById('settingsModal');
    const closeSettingsBtn=document.getElementById('closeSettingsBtn');
    const discountPercentageInput=document.getElementById('discountPercentage');

    settingsBtn.addEventListener('click',()=>settingsModal.classList.remove('hidden'));
    closeSettingsBtn.addEventListener('click',()=>settingsModal.classList.add('hidden'));
    settingsModal.addEventListener('click',e=>{if(e.target===settingsModal)settingsModal.classList.add('hidden');});
    discountPercentageInput.addEventListener('input',()=>{
      const n=parseFloat(discountPercentageInput.value);
      if(!isNaN(n)&&n>=0){jewelleryDiscountPercentage=n/100;calculateJewelleryPrice();}
    });

    // Event listeners
    document.getElementById('rate9999').addEventListener('input',debounce(calculateRates,300));
    document.getElementById('jewelleryWeight').addEventListener('input',debounce(calculateJewelleryPrice,300));
    document.getElementById('otherCosts').addEventListener('input',debounce(calculateJewelleryPrice,300));
    document.querySelectorAll('input[name="jewelleryPurity"]').forEach(r=>r.addEventListener('change',calculateJewelleryPrice));
    
    document.getElementById('diamondCaratRate1').addEventListener('input', debounce(calculateDiamondTotal, 300));
    document.getElementById('diamondCaratWeight1').addEventListener('input', debounce(calculateDiamondTotal, 300));
    document.getElementById('diamondCaratRate2').addEventListener('input', debounce(calculateDiamondTotal, 300));
    document.getElementById('diamondCaratWeight2').addEventListener('input', debounce(calculateDiamondTotal, 300));
    document.getElementById('diamondCaratRate3').addEventListener('input', debounce(calculateDiamondTotal, 300));
    document.getElementById('diamondCaratWeight3').addEventListener('input', debounce(calculateDiamondTotal, 300));
    document.getElementById('toggleRatesBtn').addEventListener('click', toggleRateView);

    // Initial load
    updateGoldRatesDisplay();
  </script>
</body>
</html>
